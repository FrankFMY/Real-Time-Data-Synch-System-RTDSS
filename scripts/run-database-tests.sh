#!/bin/bash

# Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° database SQL Ñ‚ĞµÑÑ‚Ğ¾Ğ²

echo "ğŸ§ª Running PostgreSQL database tests..."
echo ""

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‡Ñ‚Ğ¾ PostgreSQL Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½
if ! docker ps | grep -q sandbox-db; then
    echo "âŒ PostgreSQL container not running!"
    echo "Run: pnpm db:start"
    exit 1
fi

echo "âœ… PostgreSQL container running"
echo ""

# Ğ—Ğ°Ğ¿ÑƒÑĞº SQL Ñ‚ĞµÑÑ‚Ğ¾Ğ²
echo "Running tests/database/triggers.test.sql..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

docker exec -i sandbox-db-1 psql -U root -d local < tests/database/triggers.test.sql

if [ $? -eq 0 ]; then
    echo ""
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "âœ… All database tests passed!"
else
    echo ""
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "âŒ Database tests failed!"
    exit 1
fi

